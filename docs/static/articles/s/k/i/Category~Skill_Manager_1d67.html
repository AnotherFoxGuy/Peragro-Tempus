<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/favicon.ico"/>
    <title>Category:Skill Manager - Peragro Tempus Wiki</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
    <script type="text/javascript" src="../../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../../raw/MediaWiki%7ECommon.css";
@import "../../../../raw/MediaWiki%7EMonobook.css";
@import "../../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="page-Category_Skill_Manager">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Category:Skill Manager</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Peragro Tempus Wiki</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <p><br />
</p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Skill_Manager"><span class="tocnumber">1</span> <span class="toctext">Skill Manager</span></a></li>
<li class="toclevel-1"><a href="#Reason_for_change"><span class="tocnumber">2</span> <span class="toctext">Reason for change</span></a></li>
<li class="toclevel-1"><a href="#The_new_XML"><span class="tocnumber">3</span> <span class="toctext">The new XML</span></a></li>
<li class="toclevel-1"><a href="#The_idea"><span class="tocnumber">4</span> <span class="toctext">The idea</span></a>
<ul>
<li class="toclevel-2"><a href="#Server-side_behaviour"><span class="tocnumber">4.1</span> <span class="toctext">Server-side behaviour</span></a></li>
<li class="toclevel-2"><a href="#Client-side_behaviour"><span class="tocnumber">4.2</span> <span class="toctext">Client-side behaviour</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Examples"><span class="tocnumber">5</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Harvesting_Skill"><span class="tocnumber">5.1</span> <span class="toctext">Harvesting Skill</span></a>
<ul>
<li class="toclevel-3"><a href="#Server"><span class="tocnumber">5.1.1</span> <span class="toctext">Server</span></a></li>
<li class="toclevel-3"><a href="#Client"><span class="tocnumber">5.1.2</span> <span class="toctext">Client</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Mana_Shield"><span class="tocnumber">5.2</span> <span class="toctext">Mana Shield</span></a>
<ul>
<li class="toclevel-3"><a href="#Server_2"><span class="tocnumber">5.2.1</span> <span class="toctext">Server</span></a></li>
<li class="toclevel-3"><a href="#Client_2"><span class="tocnumber">5.2.2</span> <span class="toctext">Client</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Hit"><span class="tocnumber">5.3</span> <span class="toctext">Hit</span></a>
<ul>
<li class="toclevel-3"><a href="#Server_3"><span class="tocnumber">5.3.1</span> <span class="toctext">Server</span></a></li>
<li class="toclevel-3"><a href="#Client_3"><span class="tocnumber">5.3.2</span> <span class="toctext">Client</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Templates"><span class="tocnumber">6</span> <span class="toctext">Templates</span></a></li>
<li class="toclevel-1"><a href="#Comments"><span class="tocnumber">7</span> <span class="toctext">Comments</span></a>
<ul>
<li class="toclevel-2"><a href="#josePhoenix"><span class="tocnumber">7.1</span> <span class="toctext">josePhoenix</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Deprecated"><span class="tocnumber">8</span> <span class="toctext">Deprecated</span></a>
<ul>
<li class="toclevel-2"><a href="#Thoughts"><span class="tocnumber">8.1</span> <span class="toctext">Thoughts</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Skill_Manager"></a><h1> <span class="mw-headline"> Skill Manager </span></h1>
<p>This will parse an XML file which lists all possible skills.
This same file will also be used by the server, so client and server
are always synced.
</p>
<a name="Reason_for_change"></a><h1> <span class="mw-headline"> Reason for change </span></h1>
<p>Although the other method had the advantage of nice layout of damage properties 
and requirements, the urge for more kinds of damage(firedamage, buffs, affect,..)
and that it was very static(would need a xml formule parser) made it very limiting
and required it to have an insane amount of glue code.
</p><p>Example: A mana shield that absorbs damage at the cost of mana.
This would have been impossible with the old system.
</p>
<a name="The_new_XML"></a><h1> <span class="mw-headline"> The new XML </span></h1>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;skills&gt;

	&lt;skill&gt;
		&lt;id&gt;1&lt;/id&gt;
		&lt;name&gt;Heal&lt;/name&gt;
		&lt;description&gt;Rejuvenates the target by 10 HP.&lt;/description&gt;
		&lt;icon&gt;set:Skill image:Heal&lt;/icon&gt;
		&lt;behaviour&gt;
                   &lt;!-- Script to define skill behavior on the client, see the Examples section --&gt;
                   &lt;client&gt;/peragro/behaviours/skills/spells/heal-client.py&lt;client&gt;
                   &lt;!-- The same but for the server --&gt; 
                   &lt;server&gt;/peragro/behaviours/skills/spells/heal-server.py&lt;server&gt; 
		&lt;/behaviour&gt;
	&lt;/skill&gt;

&lt;/skills&gt;


</pre>
<a name="The_idea"></a><h1> <span class="mw-headline"> The idea </span></h1>
<p>Each skill is a factory template, having it's own properties and behaviour.
It is endlessly looped untill either it deletes itself(timer expired,...) or its forced deleted from
the outside (A skillcancelrequest has been send).
</p><p>A skill can have several possible inputs:
</p>
<ul><li>Entity: The skill is applied to this entity.
</li><li>Position: The skill is applied to this position/region, the behaviour can either gather the entities around(think area of effect spells) or check for incoming entities(think traps).
</li></ul>
<p>The XML should be reloadable(like on the client with the itemmgr) so everything can be updated on the fly,
on the client with the console, and on the server by sending an admin command orso.
</p>
<a name="Server-side_behaviour"></a><h2> <span class="mw-headline"> Server-side behaviour </span></h2>
<ul><li>Check the caster for skill requirements (enough str?)
</li><li>Check target requirements(range? entitytype?)
</li><li>Calculate changes and apply.
</li></ul>
<a name="Client-side_behaviour"></a><h2> <span class="mw-headline"> Client-side behaviour </span></h2>
<ul><li>Attaching effects.
</li><li>Movings effects(projectile, fireball,...)
</li><li>Animations.
</li><li>Etc...
</li></ul>
<a name="Examples"></a><h1> <span class="mw-headline"> Examples </span></h1>
<p>(think script, but i dont know any&nbsp;:) )
</p>
<a name="Harvesting_Skill"></a><h2> <span class="mw-headline"> Harvesting Skill </span></h2>
<p>Pseudo code for harvesting skill.
</p>
<a name="Server"></a><h3> <span class="mw-headline"> Server </span></h3>
<pre>
// Skill properties
this.range = 1;
this.stamina = 20;
this.casttime = 3000;
this.timer = 0;

Skill::Skill()
{
  // Checks
  if(!target.type == Entity::Bush) delete this;
  if(this.range &lt; GetDistance(caster, target)) delete this;
  if(caster.harvestskill &lt; target.requiredskill) delete this;
  if(caster.stamina &lt; (this.stamina * target.requiredskill)) delete this;

  // All checks passed: perform.
  caster.stamina -= (this.stamina * target.requiredskill);
  caster.skills.harvestskill.SetState(USED);
  caster.SetState(CASTING);
  target.Disable(); // Disable interaction for others while youre harvesting.
}

Skill::Tick()
{
  if(this.timer &gt; this.casttime)
   {
     caster.exp.harvestskill += target.reward.exp;
     caster.inventory.add(target.reward.items);
     target.reward.items = 0;
     ReGrow(target); // Request a timercallback for readding rewards.
     target.Enable() // Re-enable interaction.
     caster.SetState(READY);
     delete this; // The skill has finished and can be deleted.
   }
  this.timer += 1;
}

</pre>
<a name="Client"></a><h3> <span class="mw-headline"> Client </span></h3>
<pre>
Skill::Skill()
{
  target.AddEffect(&quot;glow&quot;, 2000);
  target.SetAnimation(&quot;wave&quot;, 3000);
  caster.AddEffect(&quot;harvest&quot;, 2000);
  caster.SetAnimation(&quot;harvest&quot;, 3000);
  delete this; // This skill doesn't need to loop and can be deleted.
}

Skill::Tick(){}

</pre>
<p><br />
</p>
<a name="Mana_Shield"></a><h2> <span class="mw-headline"> Mana Shield </span></h2>
<a name="Server_2"></a><h3> <span class="mw-headline"> Server </span></h3>
<pre>
// Skill properties.
this.requiredskill = 5;
this.mana = 20;
this.casttime = 2000;
this.timer = 0;
this.iscast = false;
this.hp = 0;

Skill::Skill()
{
  // Checks. 
  if(!target == caster) delete this;  
  if(caster.skills.shieldskill.GetValue() &lt; this.requiredskill) delete this;
  if(caster.mana &lt; this.mana) delete this;

  // If the skill is already active, uncast it.
  skill = Findskill(target, &quot;manashield&quot;);
  if(skill) { delete skill; delete this; }

  // All checks passed: perform.
  caster.mana -= this.mana;
  caster.skills.manashield.SetState(USED);
  caster.SetState(CASTING);
}

Skill::Tick()
{
  if(this.iscast)
   {
     if(this.hp &gt; target.hp)
       {
         difference = this.hp - target.hp;
         difference = difference / caster.skills.shieldskill.GetValue();
         if(target.mp =&lt; difference )
          {
            delta = difference - target.mp;
            target.mp = 0;
            target.hp -= delta;
            delete this;  
          }
         else
          {
            target.mp -= difference;
            target.hp = this.hp;
          }
       }
     return;
   }

  if(this.timer &gt; this.casttime)
   {
     this.iscast = true;
     this.hp = target.hp;   
     caster.SetState(READY); 
   }

  timer += 1;
}
</pre> 
<a name="Client_2"></a><h3> <span class="mw-headline"> Client </span></h3>
<pre>
Skill::Skill()
{
  // If the skill is already active, uncast it.
  skill = Findskill(target, &quot;manashield&quot;);
  if(skill) { delete skill; delete this; }

  target.AddEffect(&quot;glow&quot;);
}

Skill::Tick()
{
  if(target.mp == 0)
   {
     target.RemoveEffect(&quot;glow&quot;);
     delete this;
   }
}
</pre>
<a name="Hit"></a><h2> <span class="mw-headline"> Hit </span></h2>
<a name="Server_3"></a><h3> <span class="mw-headline"> Server </span></h3>
<pre>
// Skill properties.
this.casttime = 0;
this.timer = 0;
this.iscast = false;

Skill::Skill()
{
  // Checks. 
  if(!target == EntityType::Character) delete this; 

  weapons = caster.GetEquipment().GetWeapons();
  if(weapons)
   {
     for(i; weapons.length(); i++)
      {
        speed = weapons.Get(i).speed;
        if(weaponspeed &lt; speed)
          weaponspeed = speed;
      }
     this.casttime = weaponspeed / caster.dex;
   }
  else
    this.casttime = items.FindByName(&quot;Fists&quot;).speed;

  caster.skills.hit.SetState(USED);
  caster.SetState(CASTING);  
}

Skill::Tick()
{
  if(this.iscast)
   {
     weapon = caster.GetEquipment().GetWeapon();
     if(weapon)
      {
        switch(weapon.type)
         {
           case WeaponType::Sword:
             damage = (caster.str*caster.dex)/2 + weapon.damage;
             influence = {&quot;str&quot;, &quot;dex&quot;};
             break;
           case WeaponType::Hammer:
             damage = caster.str + weapon.damage;
             influence = {&quot;str&quot;};
             break;
         }
      }
     else
      {
        damage = (caster.str*caster.con)/2 + items.FindByName(&quot;Fists&quot;).damage;
      }

     if(Throw(caster, dex) &gt; Throw(target, dex))
      {
         target.hp -= damage - target.defense;
         caster.skills.GetSkill(weapon) += 100;
         for(i; influence.length(); i++)
          {
            caster.(influence(i)) += 0.02/influence.length();
          } 
      }
     else
      {
         caster.skills.GetSkill(weapon) += 5; 
      }

     caster.SetState(READY); 
     delete this;
   }

  if(this.timer &gt; this.casttime)
     this.iscast = true;

  timer += 1;
}
</pre>
<a name="Client_3"></a><h3> <span class="mw-headline"> Client </span></h3>
<pre>
Skill::Skill()
{
  weapon = caster.GetEquipment().GetWeapon();
  if(weapon)
   {
     switch(weapon.type)
      {
        case WeaponType::Sword:
          caster.SetAnimation(&quot;attack_sword&quot;, 2500);
          break;
        case WeaponType::Hammer:
          caster.SetAnimation(&quot;attack_hammer&quot;, 3000);
          break;
      }
   }
  else
   {
     caster.SetAnimation(&quot;attack_fists&quot;, 3000);
   }
}

Skill::Tick()
{
  delete this;
}
</pre>
<p><br />
</p>
<a name="Templates"></a><h1> <span class="mw-headline"> Templates </span></h1>
<p>???
</p>
<a name="Comments"></a><h1> <span class="mw-headline"> Comments </span></h1>
<a name="josePhoenix"></a><h4> <span class="mw-headline"> josePhoenix </span></h4>
<p>Requesting change for the line "&lt;icon&gt;set:Skill image:Heal&lt;/icon&gt;"
sueastside says this is the way to specify an image to CeGUI, which would decrease overhead a little
however, if PT ever decides to move from CeGUI, this would add more work
I propose this format to make it more abstracted: &lt;icon set="skills"&gt;Heal&lt;/icon&gt;
</p><p><br />
</p>
<a name="Deprecated"></a><h1> <span class="mw-headline"> Deprecated </span></h1>
<p><b>THIS IS AN IDEA DRAFT, IT'S IN NO WAY FINISHED OR EVEN GARANTEED TO LOOK REMOTELY LIKE THIS AT ALL</b>
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;skills&gt;

	&lt;skill&gt;
		&lt;id&gt;1&lt;/id&gt;
		&lt;name&gt;Heal&lt;/name&gt;
		&lt;description&gt;Rejuvenates the target by 10 HP.&lt;/description&gt;
		&lt;icon&gt;set:Skill image:Heal&lt;/icon&gt;
		&lt;effects&gt;
			&lt;caster&gt;HealSpellPentagram&lt;/caster&gt;
			&lt;castanim&gt;cast_divine&lt;/castanim&gt;
			&lt;weapon&gt;none&lt;/weapon&gt;
			&lt;target&gt;HealSpellEffect&lt;/target&gt;
			&lt;projectile&gt;none&lt;/projectile&gt;	
		&lt;/effects&gt;
		&lt;stats&gt;
			&lt;range&gt;5&lt;/range&gt;
			&lt;duration&gt;0&lt;/duration&gt;
			&lt;casttime&gt;10&lt;/casttime&gt;
			&lt;reusedelay&gt;100&lt;/reusedelay&gt;
		&lt;/stats&gt;
		&lt;cost&gt;
			&lt;hp&gt;0&lt;/hp&gt;
			&lt;mp&gt;10&lt;/mp&gt;
			&lt;sp&gt;0&lt;/sp&gt;
		&lt;/cost&gt;
		&lt;damage&gt;
			&lt;hp&gt;-10&lt;/hp&gt;
			&lt;mp&gt;0&lt;/mp&gt;
			&lt;sp&gt;0&lt;/sp&gt;	
		&lt;/damage&gt;
		&lt;requirements&gt;
			&lt;int&gt;10&lt;/int&gt;
			&lt;men&gt;5&lt;/men&gt;
		&lt;/requirements&gt;
	&lt;/skill&gt;

&lt;/skills&gt;


</pre>
<a name="Thoughts"></a><h2> <span class="mw-headline"> Thoughts </span></h2>
<ul><li> Needs a way to do expressions, like damage based on a stat or weapon mastery.
</li></ul>
<pre>
Examples:
- &lt;cost&gt;&lt;mp&gt;(SKILL_LEVEL * 10)&lt;/mp&gt;&lt;/cost&gt;
- &lt;damage&gt;&lt;hp&gt;((((STAT_INT*STAT_MEN)/2)* SKILL_LEVEL * WEAPON_MAGIC_DAMAGE * -10)+ WEAPON_MAGIC_BONUS)&lt;/hp&gt;&lt;/damage&gt;
- &lt;requirements&gt;&lt;int&gt;(SKILL_LEVEL * 10)&lt;/int&gt;&lt;men&gt;(SKILL_LEVEL * 5)&lt;/men&gt;&lt;/requirements&gt;
</pre>
<ul><li> How to do area of effect? Do this on the server and just apply it to each entity individualy?
</li><li> How to do buffs?  (&lt;affect&gt;? unlike damage its 'does not' add up during the duration)
</li></ul>

<!-- 
NewPP limit report
Preprocessor node count: 49/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->
<div id="mw-pages">
<h2>Pages in category "Skill Manager"</h2>
<p>The following 3 pages are in this category, out of 3 total.
</p><h3>S</h3>
<ul><li><a href="../../../../articles/s/k/i/Skill_Manager_c166.html" title="Skill Manager">Skill Manager</a></li><li><a href="../../../../articles/s/k/i/Skill_Manager_%28old_version%29_953c.html" title="Skill Manager (old version)">Skill Manager (old version)</a></li><li><a href="../../../../articles/s/k/i/Skill_Manager_Pseudocode_c972.html" title="Skill Manager/Pseudocode">Skill Manager/Pseudocode</a></li></ul>
</div><div class="printfooter">
</div>
	    <div id="catlinks"><div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="../../../../articles/c/a/t/Special%7ECategories_101d.html" title="Special:Categories">Category</a>:&#32;<span dir='ltr'><a href="../../../../articles/c/l/i/Category%7EClient_a60f.html" title="Category:Client">Client</a></span></div></div></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-category"
	       class="selected"	       ><a href="../../../../articles/s/k/i/Category%7ESkill_Manager_1d67.html">Category</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../../articles/s/k/i/Category_talk%7ESkill_Manager_cadb.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://localhost/index.php/Category:Skill_Manager">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/clock_half.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage-description"><a href="../../../../index.html">Main Page</a></li>
	     	      <li id="n-portal"><a href="../../../../articles/c/o/m/Peragro_Tempus_Wiki%7ECommunity_Portal_9ca7.html">Community portal</a></li>
	     	      <li id="n-currentevents"><a href="../../../../articles/c/u/r/Peragro_Tempus_Wiki%7ECurrent_events_57bd.html">Current events</a></li>
	     	      <li id="n-help"><a href="../../../../articles/c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-SEARCH'>
	  <h5>SEARCH</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-TOOLBOX'>
	  <h5>TOOLBOX</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-LANGUAGES'>
	  <h5>LANGUAGES</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>		<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 21:36, 22 November 2006 by <a href="../../../../articles/s/u/e/User%7ESueastside_0e95.html" title="User:Sueastside">Jelle Hellemans</a>. Based on work by <a href="../../../../articles/j/o/s/User%7EJosePhoenix_0279.html" title="User:JosePhoenix">Joseph Long</a>.</li>	  	  <li id="f-about"><a href="../../../../articles/a/b/o/Peragro_Tempus_Wiki%7EAbout_5c7d.html" title="Peragro Tempus Wiki:About">About Peragro Tempus Wiki</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/Peragro_Tempus_Wiki%7EGeneral_disclaimer_934d.html" title="Peragro Tempus Wiki:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
